# Project Workflows: Supporting Common Development Tasks

This document outlines Git Monkey's approach to supporting everyday development activities beyond Git, with special focus on project setup, maintenance, and problem-solving.

## Core Workflows

### 1. Project Scaffolding

```bash
# commands/create.sh
scaffold_project() {
  local project_type="$1"
  local project_name="$2"
  
  case "$project_type" in
    "svelte")
      scaffold_svelte_project "$project_name"
      ;;
    "react")
      scaffold_react_project "$project_name"
      ;;
    # More project types...
  esac
}

scaffold_svelte_project() {
  local project_name="$1"
  
  echo "$info_emoji Creating new Svelte project: $project_name"
  npm create svelte@latest "$project_name"
  
  # Change into the project directory
  cd "$project_name" || return 1
  
  # Install dependencies
  npm install
  
  # Initialize Git repository
  git init
  git add .
  
  # Set up important configs
  git config --local core.autocrlf false
  git config --local pull.rebase true
  
  # Create useful .gitignore
  if ! grep -q "node_modules" .gitignore 2>/dev/null; then
    echo "node_modules" >> .gitignore
  fi
  
  if ! grep -q ".env" .gitignore 2>/dev/null; then
    echo ".env" >> .gitignore
  fi
  
  # Create initial commit
  git commit -m "feat: initial Svelte project setup"
  
  # Create development branch
  git branch develop
  git checkout develop
  
  # Create other useful project files
  create_env_files
  create_readme
  
  echo "$success_emoji Svelte project setup complete!"
  echo ""
  echo "To start developing:"
  echo "  cd $project_name"
  echo "  npm run dev"
}
```

### 2. Node Module Issues

```bash
# commands/fix.sh
fix_node_modules() {
  echo "$info_emoji Checking for Node.js project..."
  
  if [ ! -f "package.json" ]; then
    echo "$error_emoji No package.json found. Is this a Node.js project?"
    return 1
  fi
  
  if [ "$TONE_STAGE" -le 2 ]; then
    echo "I'll help resolve node_modules issues by removing and reinstalling dependencies."
    echo "This often fixes strange errors and 'module not found' problems."
  fi
  
  # Detect package manager
  if [ -f "yarn.lock" ]; then
    echo "🧶 Using Yarn as package manager"
    rm -rf node_modules
    yarn install
  elif [ -f "pnpm-lock.yaml" ]; then
    echo "📦 Using pnpm as package manager"
    rm -rf node_modules
    pnpm install
  else
    echo "📦 Using npm as package manager"
    rm -rf node_modules package-lock.json
    npm install
  fi
  
  echo "$success_emoji Node modules reinstalled successfully!"
  
  # For beginners, explain what this fixed
  if [ "$TONE_STAGE" -le 2 ]; then
    echo ""
    echo "💡 Why this helps: Node.js dependencies can sometimes get into a"
    echo "   broken state, especially when switching branches or updating."
    echo "   A clean reinstall gives you a fresh start with the correct"
    echo "   dependency versions."
  fi
}
```

### 3. Environment File Management

```bash
# commands/env.sh
setup_env_files() {
  if [ -f ".env" ]; then
    if [ "$TONE_STAGE" -le 2 ]; then
      echo "$warning_emoji An .env file already exists. Creating .env.example instead..."
    fi
    
    # Create example file from existing .env, but strip actual values
    grep -v "^#" .env | sed 's/=.*$/=YOUR_VALUE_HERE/' > .env.example
    
    echo "$success_emoji Created .env.example template!"
    return 0
  fi
  
  # Create both files
  echo "# Environment Variables" > .env.example
  echo "# Generated by Git Monkey" >> .env.example
  
  # Detect project type and add appropriate variables
  if [ -f "package.json" ]; then
    # Check for common frameworks and add appropriate variables
    if grep -q "\"svelte\":" package.json; then
      echo "# Svelte environment variables" >> .env.example
      echo "VITE_API_URL=http://localhost:5000/api" >> .env.example
    elif grep -q "\"react\":" package.json; then
      echo "# React environment variables" >> .env.example
      echo "REACT_APP_API_URL=http://localhost:5000/api" >> .env.example
    elif grep -q "\"next\":" package.json; then
      echo "# Next.js environment variables" >> .env.example
      echo "NEXT_PUBLIC_API_URL=http://localhost:5000/api" >> .env.example
    else
      echo "# Node.js environment variables" >> .env.example
      echo "API_URL=http://localhost:5000/api" >> .env.example
      echo "PORT=3000" >> .env.example
    fi
    
    # Add database variables if applicable
    if grep -q "\"mongoose\":|\"sequelize\":|\"prisma\":" package.json; then
      echo "" >> .env.example
      echo "# Database configuration" >> .env.example
      echo "DATABASE_URL=mongodb://localhost:27017/mydb" >> .env.example
    fi
    
    # Add auth variables if applicable
    if grep -q "\"jsonwebtoken\":|\"passport\":|\"auth0\":" package.json; then
      echo "" >> .env.example
      echo "# Authentication" >> .env.example
      echo "JWT_SECRET=your_jwt_secret_key_here" >> .env.example
      echo "JWT_EXPIRES_IN=7d" >> .env.example
    fi
  elif [ -f "requirements.txt" ] || [ -f "setup.py" ]; then
    # Python project
    echo "# Python environment variables" >> .env.example
    echo "DEBUG=True" >> .env.example
    echo "SECRET_KEY=your_secret_key_here" >> .env.example
    echo "DATABASE_URL=sqlite:///db.sqlite3" >> .env.example
  fi
  
  # Copy example to actual .env file
  cp .env.example .env
  
  # Add to .gitignore
  if [ -f ".gitignore" ]; then
    if ! grep -q "^\.env$" .gitignore; then
      echo "" >> .gitignore
      echo "# Environment variables" >> .gitignore
      echo ".env" >> .gitignore
      echo ".env.local" >> .gitignore
    fi
  else
    echo ".env" > .gitignore
    echo ".env.local" >> .gitignore
  fi
  
  if [ "$TONE_STAGE" -le 2 ]; then
    echo "$success_emoji Environment files created!"
    echo ""
    echo "💡 What are .env files?"
    echo "   They store secret configuration like API keys and passwords"
    echo "   that shouldn't be in your code or Git repository."
    echo ""
    echo "   • .env - Your personal settings (not committed to Git)"
    echo "   • .env.example - Template showing what variables are needed (committed to Git)"
    echo ""
    echo "I've added .env to .gitignore to keep your secrets safe!"
  else
    echo "$success_emoji Environment files created and added to .gitignore."
  fi
}
```

### 4. Cross-Platform Script Helper

```bash
# commands/script.sh
create_npm_scripts() {
  if [ ! -f "package.json" ]; then
    echo "$error_emoji No package.json found. Is this a Node.js project?"
    return 1
  fi
  
  # Analyze existing scripts
  if [ "$TONE_STAGE" -le 2 ]; then
    echo "$info_emoji I'll help you create cross-platform npm scripts!"
    echo "Scripts in package.json let you run commands with 'npm run X'"
  fi
  
  # Temporary file for new package.json
  local temp_file=$(mktemp)
  
  # Create cross-platform dev script
  if ! grep -q "\"dev\":" package.json; then
    if [ "$TONE_STAGE" -le 2 ]; then
      echo "Adding 'dev' script for starting development server..."
    fi
    
    # Detect project type
    if grep -q "\"svelte\":" package.json; then
      jq '.scripts.dev = "vite dev"' package.json > "$temp_file"
      cp "$temp_file" package.json
    elif grep -q "\"react-scripts\":" package.json; then
      jq '.scripts.dev = "react-scripts start"' package.json > "$temp_file"
      cp "$temp_file" package.json
    elif grep -q "\"next\":" package.json; then
      jq '.scripts.dev = "next dev"' package.json > "$temp_file"
      cp "$temp_file" package.json
    fi
  fi
  
  # Add cross-platform clean script
  if ! grep -q "\"clean\":" package.json; then
    if [ "$TONE_STAGE" -le 2 ]; then
      echo "Adding 'clean' script to remove build artifacts..."
    fi
    
    # Create platform-independent clean command using rimraf
    if ! grep -q "\"rimraf\":" package.json; then
      echo "Installing rimraf for cross-platform file deletion..."
      npm install --save-dev rimraf
    fi
    
    jq '.scripts.clean = "rimraf node_modules build dist .svelte-kit"' package.json > "$temp_file"
    cp "$temp_file" package.json
  fi
  
  rm -f "$temp_file"
  
  echo "$success_emoji Scripts updated in package.json!"
  echo "You can now run: npm run dev, npm run clean"
}
```

### 5. Git Pattern Detection & Workflow Assistance

```bash
# utils/pattern_detector.sh
detect_workflow_pattern() {
  local recent_commands=($(get_recent_commands 5))
  
  # Check for branch-commit-push pattern
  if array_contains "branch" "${recent_commands[@]}" && \
     array_contains "commit" "${recent_commands[@]}" && \
     array_contains "push" "${recent_commands[@]}"; then
    
    # This looks like a feature development workflow
    if [ "$TONE_STAGE" -le 3 ] && (( RANDOM % 3 == 0 )); then
      echo ""
      echo "$info_emoji I notice you're developing a feature branch!"
      echo "Consider creating a pull request with: gitmonkey pr create"
    fi
  fi
  
  # Check for multiple commits without pushing
  local unpushed_commits=$(git rev-list @{u}.. 2>/dev/null | wc -l | tr -d ' ')
  if [ "$unpushed_commits" -ge 3 ]; then
    if [ "$TONE_STAGE" -le 3 ] && (( RANDOM % 2 == 0 )); then
      echo ""
      echo "$info_emoji You have $unpushed_commits unpushed commits."
      echo "Remember to push your changes with: gitmonkey push"
    fi
  fi
}
```

### 6. Project Backups and Safety

```bash
# commands/backup.sh
backup_project() {
  local backup_name="${1:-backup-$(date +%Y%m%d-%H%M%S)}"
  
  # Ensure we're in a git repository
  if ! git rev-parse --is-inside-work-tree &>/dev/null; then
    echo "$error_emoji Not inside a Git repository."
    return 1
  fi
  
  # Check for uncommitted changes
  if [ -n "$(git status --porcelain)" ]; then
    if [ "$TONE_STAGE" -le 2 ]; then
      echo "$warning_emoji You have uncommitted changes that won't be in the backup."
      echo "Consider committing first with: gitmonkey commit"
      
      read -p "Continue with backup anyway? (y/n): " continue_backup
      if [[ ! "$continue_backup" =~ [Yy] ]]; then
        echo "Backup cancelled."
        return 1
      fi
    else
      echo "$warning_emoji Uncommitted changes detected."
    fi
  fi
  
  # Create backup branch
  echo "$info_emoji Creating backup branch: $backup_name"
  git branch "$backup_name"
  
  # Create backup archive
  local repo_root=$(git rev-parse --show-toplevel)
  local repo_name=$(basename "$repo_root")
  local backup_file="../${repo_name}-${backup_name}.zip"
  
  if [ "$TONE_STAGE" -le 2 ]; then
    echo "Creating zip archive backup..."
  fi
  
  # Create zip archive excluding .git, node_modules, etc.
  (cd "$repo_root" && zip -r "$backup_file" . -x "*.git*" -x "*node_modules*" -x "*build*" -x "*dist*")
  
  echo "$success_emoji Backup complete!"
  echo "• Branch backup: $backup_name"
  echo "• Archive: $backup_file"
  
  if [ "$TONE_STAGE" -le 2 ]; then
    echo ""
    echo "💡 Why two backups?"
    echo "   • Git branch: Easy to restore within Git, but only includes committed files"
    echo "   • Zip archive: Includes everything, even uncommitted changes"
  fi
}
```

### 7. Project Analytics

```bash
# commands/stats.sh
show_project_stats() {
  if ! git rev-parse --is-inside-work-tree &>/dev/null; then
    echo "$error_emoji Not inside a Git repository."
    return 1
  fi
  
  echo "$info_emoji Analyzing project..."
  
  # Project size statistics
  echo ""
  echo "📊 PROJECT SIZE"
  
  # Count files by type
  local js_files=$(find . -name "*.js" -not -path "*/node_modules/*" -not -path "*/build/*" | wc -l)
  local ts_files=$(find . -name "*.ts" -not -path "*/node_modules/*" -not -path "*/build/*" | wc -l)
  local css_files=$(find . -name "*.css" -not -path "*/node_modules/*" -not -path "*/build/*" | wc -l)
  
  echo "• JavaScript files: $js_files"
  echo "• TypeScript files: $ts_files"
  echo "• CSS files: $css_files"
  
  # Git contribution statistics
  echo ""
  echo "📝 CONTRIBUTION STATS"
  
  local total_commits=$(git rev-list --count HEAD)
  local total_days=$(( ( $(date +%s) - $(git log --format="%at" | tail -1) ) / 86400 ))
  
  echo "• Total commits: $total_commits"
  echo "• Project age: $total_days days"
  echo "• Commits per day: $(echo "scale=1; $total_commits / $total_days" | bc)"
  
  # Contribution by author
  echo ""
  echo "👥 TEAM CONTRIBUTIONS"
  git shortlog -s -n
  
  # Recently active files
  echo ""
  echo "🔥 RECENTLY ACTIVE FILES"
  git log --name-only --pretty=format: -n 20 | grep -v '^$' | sort | uniq -c | sort -nr | head -10
}
```

### 8. Dependency Management

```bash
# commands/deps.sh
check_dependencies() {
  if [ ! -f "package.json" ]; then
    echo "$error_emoji No package.json found. Is this a Node.js project?"
    return 1
  fi
  
  echo "$info_emoji Checking dependencies..."
  
  # Check for outdated dependencies
  npm outdated
  
  # Check for vulnerable dependencies
  if [ "$TONE_STAGE" -le 2 ]; then
    echo ""
    echo "Checking for security vulnerabilities..."
  fi
  
  npm audit
  
  # Unused dependencies (requires depcheck)
  if command -v depcheck &>/dev/null; then
    if [ "$TONE_STAGE" -le 2 ]; then
      echo ""
      echo "Checking for unused dependencies..."
    fi
    
    depcheck --skip-missing
  else
    if [ "$TONE_STAGE" -le 3 ]; then
      echo ""
      echo "💡 Want to check for unused dependencies?"
      echo "   Install depcheck with: npm install -g depcheck"
    fi
  fi
  
  # Offer to update dependencies
  if [ "$TONE_STAGE" -le 2 ]; then
    echo ""
    read -p "Would you like to update dependencies? (y/n): " update_deps
    
    if [[ "$update_deps" =~ [Yy] ]]; then
      echo "Updating dependencies..."
      npm update
      echo "$success_emoji Dependencies updated!"
    fi
  fi
}
```

### 9. Project Configuration

```bash
# commands/config.sh
configure_project() {
  if ! git rev-parse --is-inside-work-tree &>/dev/null; then
    echo "$error_emoji Not inside a Git repository."
    return 1
  fi
  
  echo "$info_emoji Setting up project configurations..."
  
  # Set up .gitignore if missing
  if [ ! -f ".gitignore" ]; then
    create_gitignore
  fi
  
  # Set up editorconfig
  if [ ! -f ".editorconfig" ]; then
    create_editorconfig
  fi
  
  # Set up lint configs based on project type
  if [ -f "package.json" ] && [ ! -f ".eslintrc.js" ] && [ ! -f ".eslintrc.json" ]; then
    create_eslint_config
  fi
  
  # Set up VSCode settings
  if [ ! -d ".vscode" ]; then
    create_vscode_settings
  fi
  
  echo "$success_emoji Project configuration complete!"
}

create_editorconfig() {
  cat > .editorconfig << 'EOF'
# EditorConfig helps maintain consistent coding styles
# across different editors and IDEs
# https://editorconfig.org

root = true

[*]
end_of_line = lf
charset = utf-8
trim_trailing_whitespace = true
insert_final_newline = true
indent_style = space
indent_size = 2

[*.{js,ts,jsx,tsx,svelte,vue,json}]
indent_size = 2

[*.{py,go}]
indent_size = 4

[*.md]
trim_trailing_whitespace = false
EOF

  echo "✓ Created .editorconfig"
}
```

## Implementation Guidelines

When implementing these project-related commands:

1. **Always detect project type first** - Use utils/project_detector.sh
2. **Respect existing configurations** - Don't overwrite user preferences
3. **Explain what's happening** for tone stages 0-2
4. **Be concise** for tone stages 4-5
5. **Handle multiple platforms** - macOS, Windows, Linux
6. **Use standard tools where possible** - npm, yarn, pip, etc.
7. **Provide undo operations** where appropriate

## Command Structure

For project-related commands, use a consistent structure:

```
gitmonkey project <action> [options]

Actions:
  init     - Initialize a new project
  create   - Create a new project from template
  fix      - Fix common problems
  deps     - Manage dependencies
  env      - Set up environment variables
  scripts  - Create cross-platform scripts
  stats    - Show project statistics
  backup   - Create project backup
```

This structure allows for a consistent, discoverable interface while supporting a wide range of project-related tasks beyond just Git operations.

---

With these implementations, Git Monkey becomes not just a Git helper but a comprehensive project tool that assists with common development tasks, making the entire development workflow more efficient.